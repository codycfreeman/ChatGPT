<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>California YPAA Map</title>
  <style>
    html,body{margin:0;height:100%;overflow:hidden}   /* no iframe scroll */
    #map-wrapper{width:100%;height:100%}
    #map-object{width:100%;height:100%;display:block;cursor:grab}
  </style>
  <!-- Panzoom -->
  <script src="https://cdn.jsdelivr.net/npm/@panzoom/panzoom@9.4.0/dist/panzoom.min.js"></script>
</head>

<body>
  <div id="map-wrapper">
    <object id="map-object"
            data="usa-ca-optimized-viewbox.svg"
            type="image/svg+xml"></object>
  </div>

  <script>
    /* ---- 1️⃣  Panzoom directly on the <object> element ---- */
    const mapObj = document.getElementById('map-object');
    const pz = panzoom(mapObj, { smoothScroll:false });

    /* track drag distance */
    const THRESHOLD = 5;
    let dragged=false, sx=0, sy=0;

    pz.on('panstart', ev=>{
      dragged=false;
      sx=ev.detail.origEvt.clientX;
      sy=ev.detail.origEvt.clientY;
    });

    pz.on('pan', ev=>{
      const dx=Math.abs(ev.detail.origEvt.clientX - sx);
      const dy=Math.abs(ev.detail.origEvt.clientY - sy);
      if(dx>THRESHOLD||dy>THRESHOLD) dragged=true;
    });

    /* ---- 2️⃣  cancel click only if it followed a real drag ---- */
    mapObj.addEventListener('load', ()=>{
      const svgDoc = mapObj.contentDocument;
      svgDoc.querySelectorAll('a.map-link').forEach(a=>{
        a.addEventListener('click', e=>{
          if(dragged){ e.preventDefault(); dragged=false; }
        }, true);                 // capture phase
      });
    });
  </script>
</body>
</html>
