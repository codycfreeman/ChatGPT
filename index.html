<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>California YPAA Map</title>

  <style>
    /* 1️⃣  prevent scroll-bars inside the iframe */
    html, body { height:100%; margin:0; overflow:hidden; }

    /* wrapper always fills the iframe */
    #map-wrapper   { width:100%; height:100%; }

    /* object tag stretches with no border/padding */
    #map-object    { width:100%; height:100%; display:block; cursor:grab; }
  </style>

  <!-- Panzoom library (≈3 KB) -->
  <script src="https://cdn.jsdelivr.net/npm/@panzoom/panzoom@9.4.0/dist/panzoom.min.js"></script>
</head>

<body>
  <div id="map-wrapper">
    <!-- External SVG lives in the same folder -->
    <object id="map-object"
            data="usa-ca-optimized-viewbox.svg"
            type="image/svg+xml"></object>
  </div>

  <script>
    const THRESHOLD = 5;          // px movement = treated as drag

    /* Run after the SVG finishes loading */
    document.getElementById('map-object').addEventListener('load', () => {
      const svgDoc  = document.getElementById('map-object').contentDocument;
      const svgRoot = svgDoc.documentElement;          // <svg …>

      /* 2️⃣  Panzoom now listens on the SVG itself */
      const pz = panzoom(svgRoot, { smoothScroll:false });

      let startX = 0, startY = 0, dragged = false;

      pz.on('panstart', ev => {
        dragged = false;
        startX  = ev.detail.origEvt.clientX;
        startY  = ev.detail.origEvt.clientY;
      });

      pz.on('pan', ev => {
        const dx = Math.abs(ev.detail.origEvt.clientX - startX);
        const dy = Math.abs(ev.detail.origEvt.clientY - startY);
        if (dx > THRESHOLD || dy > THRESHOLD) dragged = true;
      });

      /* cancel click only if it followed a drag */
      svgDoc.querySelectorAll('a.map-link').forEach(a => {
        a.addEventListener('click', e => {
          if (dragged) { e.preventDefault(); dragged = false; }
        }, true);                                // capture phase
      });
    });
  </script>
</body>
</html>
